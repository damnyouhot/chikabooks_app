rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // íŒŒíŠ¸ë„ˆ ê·¸ë£¹
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    match /partnerGroups/{groupId} {
      // ê·¸ë£¹ ë©¤ë²„ë§Œ ì½ê¸° ê°€ëŠ¥
      allow read: if request.auth != null && 
                     request.auth.uid in resource.data.memberUids;
      // ì“°ê¸°ëŠ” ì„œë²„ë§Œ (Cloud Functions)
      allow write: if false;

      // â”€â”€ ìŠ¬ë¡¯ (ì„œë²„ë§Œ ì“°ê¸°) â”€â”€
      match /slots/{slotId} {
        allow read: if request.auth != null && 
                       request.auth.uid in get(/databases/$(database)/documents/partnerGroups/$(groupId)).data.memberUids;
        allow write: if false; // ì„œë²„ë§Œ
      }

      // â”€â”€ ì´ë²¤íŠ¸ ë¡œê·¸ (ì„œë²„ ë‚´ë¶€ìš©) â”€â”€
      match /events/{eventId} {
        allow read: if false; // í´ë¼ì´ì–¸íŠ¸ ì½ê¸° ê¸ˆì§€
        allow write: if false; // ì„œë²„ë§Œ
      }

      // â”€â”€ ë©¤ë²„ ë©”íƒ€ â”€â”€
      match /memberMeta/{uid} {
        allow read: if request.auth != null && 
                       request.auth.uid in get(/databases/$(database)/documents/partnerGroups/$(groupId)).data.memberUids;
        allow write: if false;
      }

      // â”€â”€ í™œë™ ë¡œê·¸ (ê¸°ì¡´) â”€â”€
      match /activityLogs/{logId} {
        allow read: if request.auth != null && 
                       request.auth.uid in get(/databases/$(database)/documents/partnerGroups/$(groupId)).data.memberUids;
        allow write: if false;
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ìœ ì €
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    match /users/{uid} {
      allow read: if request.auth != null && request.auth.uid == uid;
      allow write: if request.auth != null && request.auth.uid == uid;

      // â”€â”€ íŒŒíŠ¸ë„ˆ ì¸ë°•ìŠ¤ (ì„œë²„ë§Œ ì“°ê¸°) â”€â”€
      match /partnerInbox/{inboxId} {
        allow read: if request.auth != null && request.auth.uid == uid;
        allow write: if false; // ì„œë²„ë§Œ
      }

      // â”€â”€ ğŸ“ ë‚˜ë§Œ ë³´ëŠ” í•œ ì¤„ ê¸°ë¡ (notes) â”€â”€
      match /notes/{noteId} {
        allow read: if request.auth != null && request.auth.uid == uid;
        allow write: if request.auth != null && request.auth.uid == uid;
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê¸°íƒ€ ì»¬ë ‰ì…˜ (ì„ì‹œë¡œ ì „ì²´ í—ˆìš©)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    match /{document=**} {
      allow read, write: if true;
    }
  }
}